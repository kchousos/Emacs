#+STARTUP: show2levels

* QOL Stuff

** Keybinds

*** Line Numbers

#+begin_src emacs-lisp :tangle ./init.el
(global-set-key (kbd "M-<f2>") #'(lambda () (interactive) (global-display-line-numbers-mode #'toggle)))
#+end_src

*** Window Splits

#+begin_src emacs-lisp :tangle ./init.el
(defun split-and-follow-horizontally ()
  (interactive)
  (split-window-below)
  (balance-windows)
  (other-window 1))
(global-set-key (kbd "C-x 2") #'split-and-follow-horizontally)

(defun split-and-follow-vertically ()
  (interactive)
  (split-window-right)
  (balance-windows)
  (other-window 1))
(global-set-key (kbd "C-x 3") #'split-and-follow-vertically)
#+end_src

*** Input Method

#+begin_src emacs-lisp :tangle ./init.el
(add-hook 'after-init-hook (lambda () (setq default-input-method "greek")))
#+end_src

*** Kill This Buffer

#+begin_src emacs-lisp :tangle ./init.el
(global-set-key (kbd "C-x C-k") #'kill-this-buffer)
#+end_src

*** WoMan

#+begin_src emacs-lisp :tangle ./init.el
(global-set-key (kbd "C-c w") #'woman)
#+end_src

*** view-mode

#+begin_src emacs-lisp :tangle ./init.el
(global-set-key (kbd "C-z") #'view-mode)
#+end_src

*** Scroll-Lock-Mode

#+begin_src emacs-lisp :tangle ./init.el
(global-set-key (kbd "C-<print>") #'scroll-lock-mode)
#+end_src

** Sane Defaults

#+begin_src emacs-lisp :tangle ./init.el
(setq inhibit-startup-message t)

(setq frame-resize-wise t)

(tool-bar-mode -1)          ; Disable the toolbar
(tooltip-mode -1)           ; Disable tooltips
;; (menu-bar-mode -1)          ; Disable the menu bar

(set-language-environment "UTF-8")
(prefer-coding-system 'utf-8)
(set-default-coding-systems 'utf-8)

(set-default 'truncate-lines nil)

(setq x-select-enable-clipboard t)

(setq ring-bell-function 'ignore)

(defalias 'yes-or-no-p 'y-or-n-p)

(delete-selection-mode 1)

(setq column-number-mode t)

(setq frame-inhibit-implied-resize t)
#+end_src

** Fringes

#+begin_src emacs-lisp :tangle ./init.el
;; Remove the line-wrap fringe indicators
(setq-default fringe-indicator-alist (assq-delete-all 'truncation fringe-indicator-alist))

(fringe-mode 10)
#+end_src

** Word Wrap

#+begin_src emacs-lisp :tangle ./init.el
  (global-word-wrap-whitespace-mode)
#+end_src

** Blink Cursor

#+begin_src emacs-lisp :tangle ./init.el
(blink-cursor-mode 1)
#+end_src

** Highlight current line

#+begin_src emacs-lisp :tangle ./init.el
(global-hl-line-mode 0)
#+end_src

** Fullscreen by default

#+begin_src emacs-lisp :tangle ./init.el
(add-to-list 'default-frame-alist '(fullscreen . maximized))
#+end_src

** Scrolling and Scrollbars

#+begin_src emacs-lisp :tangle ./init.el
(global-set-key (kbd "M-<f3>") 'scroll-bar-mode)
(scroll-bar-mode 0)
(window-divider-mode 0)

(setq scroll-bar-adjust-thumb-portion t)

(set-window-scroll-bars (minibuffer-window) nil nil nil nil t)

;; (setq mouse-wheel-scroll-amount '(5 ((shift) . 1)))

(setq mouse-wheel-progressive-speed nil) ;; don't accelerate scrolling

(setq mouse-wheel-follow-mouse 't) ;; scroll window under mouse

(setq scroll-step 1) ;; keyboard scroll one line at a time

(pixel-scroll-precision-mode t)

;; (setq scroll-conservatively 100)
#+end_src

** Disable Backup Files

#+begin_src emacs-lisp :tangle ./init.el
(setq make-backup-files nil)
(setq auto-save-default nil)
#+end_src

** Tab Configuration

#+begin_src emacs-lisp :tangle ./init.el
(setq-default indent-tabs-mode nil)
(setq-default tab-width 4)
(setq indent-line-function #'insert-tab)
#+end_src

** Parentheses Pairs

#+begin_src emacs-lisp :tangle ./init.el
(setq electric-pair-pairs '(
                            (?\{ . ?\})
                            (?\( . ?\))
                            (?\[ . ?\])
                            (?\" . ?\")
                            ))
(electric-pair-mode t)

(add-hook 'org-mode-hook (lambda ()
           (setq-local electric-pair-inhibit-predicate
                   `(lambda (c)
                  (if (char-equal c ?<) t (,electric-pair-inhibit-predicate c))))))
#+end_src

** Line Numbers

#+begin_src emacs-lisp :tangle ./init.el
(global-display-line-numbers-mode 0)
(setq display-line-numbers-type 'relative)
#+end_src

** Warnings

#+begin_src emacs-lisp :tangle ./init.el
(setq warning-minimum-level :emergency)
#+end_src

** Recent files

#+begin_src emacs-lisp :tangle ./init.el
(recentf-mode 1)
(setq recentf-max-menu-items 25)
(setq recentf-max-saved-items 25)
(global-set-key "\C-x\ \C-r" 'recentf-open-files)
(run-at-time nil (* 5 60) 'recentf-save-list)
#+end_src

** Winner-mode

#+begin_src emacs-lisp :tangle ./init.el
(winner-mode t)
#+end_src

** eww

#+begin_src emacs-lisp :tangle ./init.el
(setq eww-auto-rename-buffer t)
(global-set-key (kbd "C-c C-w") #'eww-follow-link)
#+end_src

** Modeline

#+begin_src emacs-lisp :tangle ./init.el
(setq-default mode-line-format '("%e" mode-line-front-space
                         (:propertize
                          ("" mode-line-mule-info mode-line-client mode-line-modified mode-line-remote)
                          display
                          (min-width
                           (0.0)))
                         mode-line-frame-identification
                         mode-line-buffer-identification
                         (vc-mode vc-mode)
                         "  "
                         mode-line-position
                         "  "
                         "  "
                         mode-name
                         "  "
                         mode-line-misc-info
                         mode-line-end-spaces))
#+end_src

* Fonts

** Fonts

#+begin_src emacs-lisp :tangle ./init.el
  (defun set-font-faces ()
        (message "Setting faces!")
        (set-fontset-font t 'symbol (font-spec :family "Noto Color Emoji" :size 24))
        (set-face-attribute 'default nil :font "Iosevka" :weight 'regular :height 120)
        (set-face-attribute 'fixed-pitch nil :font "Iosevka" :weight 'regular :height 120)
        (set-face-attribute 'variable-pitch nil :font "Iosevka Aile" :weight 'regular :height 120))

(if (daemonp)
    (add-hook 'after-make-frame-functions
              (lambda (frame)
                (with-selected-frame frame
                  (set-font-faces))))
    (set-font-faces))
#+end_src

** COMMENT Lsp-Ui Fonts

#+begin_src emacs-lisp :tangle no
(custom-set-faces
 ;; custom-set-faces was added by Custom.
 ;; If you edit it by hand, you could mess it up, so be careful.
 ;; Your init file should contain only one such instance.
 ;; If there is more than one, they won't work right.
 '(lsp-ui-doc-header ((t (:family "Iosevka"))))
 '(lsp-ui-doc-highlight-hover ((t (:inherit region :family "Iosevka"))))
 '(markdown-code-face ((t (:inherit nil :weight bold :family "Iosevka"))))
 '(markdown-inline-code-face ((t (:inherit (markdown-code-face font-lock-constant-face) :family "Iosevka"))))
 '(preview-face ((t nil)))
 '(preview-reference-face ((t (:foreground "#fbf1c7")))))
(put 'erase-buffer 'disabled nil)
#+end_src

** Spacing

#+begin_src emacs-lisp :tangle ./init.el
(setq line-spacing 0.2)
#+end_src

* Packages

** Package Management

*** Straight.el

#+begin_src emacs-lisp :tangle ./init.el
(defvar bootstrap-version)
(let ((bootstrap-file
       (expand-file-name "straight/repos/straight.el/bootstrap.el" user-emacs-directory))
      (bootstrap-version 5))
  (unless (file-exists-p bootstrap-file)
    (with-current-buffer
        (url-retrieve-synchronously
         "https://raw.githubusercontent.com/raxod502/straight.el/develop/install.el"
         'silent 'inhibit-cookies)
      (goto-char (point-max))
      (eval-print-last-sexp)))
  (load bootstrap-file nil 'nomessage))

;; Use straight.el for use-package expressions
(straight-use-package 'use-package)

;; Disable package.el in favor of straight.el
(setq package-enable-at-startup nil)
#+end_src

** Color Theme

*** Modus Themes

**** COMMENT Overrides

#+begin_src emacs-lisp :tangle no
;; (set-face-attribute 'mode-line nil :box t)

(setq modus-themes-vivendi-color-overrides
      '(
        (bg-main . "#1d1f21")
        ;; (bg-dim . "#faf6ef")
        ;; (bg-alt . "#f7efe5")
        ;; (bg-active . "#e8dfd1")
        (bg-inactive . "#373b41")
        ))

(setq modus-themes-operandi-color-overrides
      '(
        (bg-main . "#fefcf4")
        ;; (bg-dim . "#faf6ef")
        ;; (bg-alt . "#f7efe5")
        ;; (bg-active . "#e8dfd1")
        (bg-inactive . "#e8dfd1")
        ))
#+end_src

#+begin_src emacs-lisp :tangle no
(defun my-modus-themes-custom-faces ()
  (set-face-attribute 'modus-themes-markup-macro nil :background (modus-themes-color 'bg-main)))

(add-hook 'modus-themes-after-load-theme-hook #'my-modus-themes-custom-faces)
#+end_src

**** Modus Themes

#+begin_src emacs-lisp :tangle ./init.el
;; (setq modus-themes-headings
;;       '((1 . (1.1))
;;         (2 . (1.075))
;;         (3 . (1.05))
;;         (4 . (1.025))
;;         (t . (1.0))))

(load-theme 'modus-operandi)

(use-package modus-themes
  :straight nil
  :init
  ;; Add all your customizations prior to loading the themes
  (setq modus-themes-italic-constructs nil
        modus-themes-bold-constructs nil
        modus-themes-mixed-fonts t
        modus-themes-subtle-line-numbers t
        modus-themes-deuteranopia nil

        modus-themes-fringes nil ; {nil,'subtle,'intense}

        ;; Options for `modus-themes-mode-line' are either nil, or a list
        ;; that can combine any of `3d' OR `moody', `borderless',
        ;; `accented'.  The variable's doc string shows all possible
        ;; combinations.
        modus-themes-mode-line nil

        ;; Options for `modus-themes-syntax': nil, 'faint,
        ;; 'yellow-comments, 'green-strings,
        ;; 'yellow-comments-green-strings, 'alt-syntax,
        ;; 'alt-syntax-yellow-comments, 'faint-yellow-comments
        modus-themes-syntax '(faint)

        ;; Options for `modus-themes-hl-line': nil, 'intense-background,
        ;; 'accented-background, 'underline-neutral,
        ;; 'underline-accented, 'underline-only-neutral,
        ;; 'underline-only-accented
        modus-themes-hl-line nil

        modus-themes-paren-match '(intense) ; {nil,'subtle-bold,'intense,'intense-bold}

        ;; Options for `modus-themes-links': nil, 'faint,
        ;; 'neutral-underline, 'faint-neutral-underline, 'no-underline,
        ;; 'underline-only, 'neutral-underline-only
        modus-themes-links '(faint neutral-underline)

        ;; Options for `modus-themes-prompts' are either nil (the
        ;; default), or a list of properties that may include any of those
        ;; symbols: `background', `bold', `gray', `intense'
        modus-themes-prompts nil

        modus-themes-completions '(opinionated) ; {nil,'moderate,'opinionated}

        ;; Options for `modus-themes-region': nil, 'no-extend, 'bg-only,
        ;; 'bg-only-no-extend, 'accent, 'accent-no-extend
        modus-themes-region nil

        ;; Options for `modus-themes-diffs': nil, 'desaturated,
        ;; 'bg-only, 'deuteranopia, 'fg-only-deuteranopia
        modus-themes-diffs '(desaturated)

        org-highlight-latex-and-related '(nil)

        modus-themes-lang-checkers '(text-also)

        modus-themes-org-blocks nil; {nil,'gray-background,'tinted-background}

        modus-themes-markup '(background)
        )
  ;; Load the theme files before enabling a theme
  (modus-themes-load-themes)
  :config
  ;; Load the theme of your choice:
  (modus-themes-load-operandi) ;; OR (modus-themes-load-vivendi)
  :bind ("<f5>" . modus-themes-toggle)
    )
#+end_src

** Fonts & Icons

*** Mixed-Pitch

#+begin_src emacs-lisp :tangle ./init.el
(use-package mixed-pitch
  :straight t
  :hook
  ;; If you want it in all text modes:
  (text-mode . mixed-pitch-mode))

(setq mixed-pitch-variable-pitch-cursor 'box)
#+end_src

*** Ligatures

#+begin_src emacs-lisp :tangle ./init.el
(use-package ligature
  :straight t
  ;; Enable traditional ligature support in eww-mode, if the
  ;; `variable-pitch' face supports it
  :config
  ;; Enable all programming ligatures in programming modes
  (ligature-set-ligatures 'prog-mode '(":::" "::=" "&&" "||" "::" ":=" "==" "!=" ">=" ">>" "<="
                                       "<<" "??" ";;" "->" "<-" "-->" "<--"
                                       ))
  ;; Enables ligature checks globally in all buffers. You can also do it
  ;; per mode with `ligature-mode'.
  (global-ligature-mode t))
#+end_src

*** Emojify

#+begin_src emacs-lisp :tangle ./init.el
(use-package emojify
    :straight t)

(setq emojify-display-style 'unicode)

;(global-emojify-mode)
#+end_src

*** All-the-Icons

#+begin_src emacs-lisp :tangle ./init.el
(use-package all-the-icons
  :straight t)
#+end_src

**** All-The-Icons-Completion

#+begin_src emacs-lisp :tangle ./init.el
(use-package all-the-icons-completion
  :straight t
  :after (marginalia all-the-icons)
  :hook (marginalia-mode . all-the-icons-completion-marginalia-setup)
  :init
  (all-the-icons-completion-mode))
#+end_src

** Misc

*** Window Navigation

**** Ace-Window

#+begin_src emacs-lisp :tangle ./init.el
(global-set-key (kbd "M-o") 'ace-window)
(setq aw-keys '(?a ?s ?d ?f ?g ?h ?j ?k ?l))
(setq aw-dispatch-always nil)
(setq aw-background nil)
(defvar aw-dispatch-alist
  '((?x aw-delete-window "Delete Window")
    (?m aw-swap-window "Swap Windows")
    (?M aw-move-window "Move Window")
    (?c aw-copy-window "Copy Window")
    (?j aw-switch-buffer-in-window "Select Buffer")
    (?n aw-flip-window)
    (?u aw-switch-buffer-other-window "Switch Buffer Other Window")
    (?c aw-split-window-fair "Split Fair Window")
    (?v aw-split-window-vert "Split Vert Window")
    (?b aw-split-window-horz "Split Horz Window")
    (?o delete-other-windows "Delete Other Windows")
    (?? aw-show-dispatch-help))
  "List of actions for `aw-dispatch-default'.")

(use-package ace-window
  :straight t)
#+end_src

**** Resize-Window

#+begin_src emacs-lisp :tangle ./init.el
(setq resizewindow-allow-backgrounds nil)
(global-set-key (kbd "C-c C-;") 'resize-window)
(use-package resize-window
  :straight t)
#+end_src

*** File History

**** Undo-Tree

#+begin_src emacs-lisp :tangle ./init.el
(use-package undo-tree
  :straight t)

(setq undo-tree-auto-save-history t)

(defadvice undo-tree-make-history-save-file-name
    (after undo-tree activate)
  (setq ad-return-value (concat ad-return-value ".gz")))

(setq undo-tree-visualizer-diff t)
(setq undo-tree-history-directory-alist '(("." . "~/.config/emacs/undo")))

(global-undo-tree-mode)
#+end_src

*** Autocompletion

**** Yasnippet

***** Yasnippet

#+begin_src emacs-lisp :tangle ./init.el
  (use-package yasnippet
      :straight t
      :config
      (setq yas-snippet-dirs '("~/.config/emacs/snippets")))

  ;; (require 'company-yasnippet)

  (add-hook 'org-mode-hook  'yas-minor-mode-on)
  (add-hook 'prog-mode-hook 'yas-minor-mode-on)
  (add-hook 'LaTeX-mode-hook 'yas-minor-mode-on)
#+end_src

***** Yasnippet-Snippets

#+begin_src emacs-lisp :tangle ./init.el
(use-package yasnippet-snippets
    :straight t)
#+end_src

**** Corfu

***** Corfu

#+begin_src emacs-lisp :tangle ./init.el
  (use-package corfu
    :straight t

    :custom
    (corfu-cycle t)                       ;; Enable cycling for `corfu-next/previous'
    (corfu-auto t)                        ;; Enable auto completion
    (corfu-separator ?\s)                 ;; Orderless field separator
    (corfu-quit-at-boundary 'separator)   ;; Never quit at completion boundary
    ;; (corfu-quit-no-match nil)          ;; Never quit, even if there is no match
    (corfu-preview-current 'insert)       ;; Disable current candidate preview
    (corfu-preselect 'prompt)             ;; Preselect the prompt
    (corfu-on-exact-match nil)            ;; Configure handling of exact matches
    ;; (corfu-scroll-margin 5)            ;; Use scroll margin
    (corfu-auto-delay 0)
    (corfu-auto-prefix 1)

    (completion-cycle-threshold nil)
    (tab-always-indent 'complete)

    ;; (corfu-min-width 80)
    ;; (corfu-max-width corfu-min-width)

    (lsp-completion-provider :none) ; Use corfu instead the default for lsp completions

    :hook (lsp-completion-mode . kb/corfu-setup-lsp) ; Use corfu for lsp completion

    :config
    ;; Setup lsp to use corfu for lsp completion
    (defun kb/corfu-setup-lsp ()
      "Use orderless completion style with lsp-capf instead of the
    default lsp-passthrough."
      (setf (alist-get 'styles (alist-get 'lsp-capf completion-category-defaults))
            '(orderless)))

    :bind
    (:map corfu-map
          ("C-n" . #'corfu-next)
          ("C-p" . #'corfu-previous)
          ("<escape>" . #'corfu-quit)
          ("<return>" . #'corfu-insert)
          ("<return>" . #'corfu-complete)
          ("C-<tab>" . corfu-insert-separator)
          ;; ("M-d" . #'corfu-show-documentation)
          ;; ("M-l" . #'corfu-show-location)
          )
          :init
          (global-corfu-mode))

(advice-add #'lsp-completion-at-point :around #'cape-wrap-noninterruptible)
#+end_src

***** COMMENT Corfu-doc

#+begin_src emacs-lisp :tangle no
(use-package corfu-doc
  ;; NOTE 2022-02-05: At the time of writing, `corfu-doc' is not yet on melpa
  :straight t
  :after corfu
  :hook (corfu-mode . corfu-doc-mode)
  :bind(:map corfu-map
             ;; This is a manual toggle for the documentation popup.
             ([remap corfu-show-documentation] . #'corfu-doc-toggle) ; Remap the default doc command
             ;; Scroll in the documentation window
             ("M-n" . #'corfu-doc-scroll-up)
             ("M-p" . #'corfu-doc-scroll-down))
  :custom
  (corfu-doc-delay 0.5)
  (corfu-doc-max-width 70)
  (corfu-doc-max-height 20)

  ;; NOTE 2022-02-05: I've also set this in the `corfu' use-package to be
  ;; extra-safe that this is set when corfu-doc is loaded. I do not want
  ;; documentation shown in both the echo area and in the `corfu-doc' popup.
  (corfu-echo-documentation nil))
#+end_src

***** kind-icon

#+begin_src emacs-lisp :tangle ./init.el
(use-package kind-icon
  :straight t
  :after corfu
  :custom
  (kind-icon-use-icons t)
  (kind-icon-default-face 'corfu-default) ; Have background color be the same as `corfu' face background
  (kind-icon-blend-background nil)  ; Use midpoint color between foreground and background colors ("blended")?
  (kind-icon-blend-frac 0.08)

  :config
  ;; enable kind-icon only in prog-mode
  (defun my/enable-kind-icon ()
    (setq-local corfu-margin-formatters '(kind-icon-margin-formatter)))
  :hook  ((prog-mode . my/enable-kind-icon))
  )
#+end_src

**** Cape

#+begin_src emacs-lisp :tangle ./init.el
(use-package cape
  :straight t
  ;; ;; Bind dedicated completion commands
  ;; ;; Alternative prefix keys: C-c p, M-p, M-+, ...
  ;; :bind (("C-c p p" . completion-at-point) ;; capf
  ;;        ("C-c p t" . complete-tag)        ;; etags
  ;;        ("C-c p d" . cape-dabbrev)        ;; or dabbrev-completion
  ;;        ("C-c p h" . cape-history)
  ;;        ("C-c p f" . cape-file)
  ;;        ("C-c p k" . cape-keyword)
  ;;        ("C-c p s" . cape-symbol)
  ;;        ("C-c p a" . cape-abbrev)
  ;;        ("C-c p i" . cape-ispell)
  ;;        ("C-c p l" . cape-line)
  ;;        ("C-c p w" . cape-dict)
  ;;        ("C-c p \\" . cape-tex)
  ;;        ("C-c p _" . cape-tex)
  ;;        ("C-c p ^" . cape-tex)
  ;;        ("C-c p &" . cape-sgml)
  ;;        ("C-c p r" . cape-rfc1345))
  :init
  ;; Add `completion-at-point-functions', used by `completion-at-point'.
  (add-to-list 'completion-at-point-functions #'cape-dabbrev)
  ;; (add-to-list 'completion-at-point-functions #'cape-file)
  ;;(add-to-list 'completion-at-point-functions #'cape-history)
  (add-to-list 'completion-at-point-functions #'cape-keyword)
  (add-to-list 'completion-at-point-functions #'cape-tex)
  ;;(add-to-list 'completion-at-point-functions #'cape-sgml)
  ;;(add-to-list 'completion-at-point-functions #'cape-rfc1345)
  (add-to-list 'completion-at-point-functions #'cape-abbrev)
  ;; (add-to-list 'completion-at-point-functions #'cape-ispell)
  ;; (add-to-list 'completion-at-point-functions #'cape-dict)
  ;;(add-to-list 'completion-at-point-functions #'cape-symbol)
  ;; (add-to-list 'completion-at-point-functions #'cape-line)
)
#+end_src

**** COMMENT Company
***** Company
#+begin_src emacs-lisp :tangle no 
(use-package company
  :straight t
  :custom
  (company-minimum-prefix-length 1)
  (company-idle-delay 0.0))

(global-company-mode)
#+end_src

***** Company-Posframe
#+begin_src emacs-lisp :tangle no
(use-package company-posframe
  :straight t)
(company-posframe-mode 1)
#+end_src

***** Company-Quickhelp
#+begin_src emacs-lisp :tangle no
(use-package company-quickhelp
  :straight t)

(company-quickhelp-mode)
#+end_src

***** Company-Lsp
#+begin_src emacs-lisp :tangle no
(use-package company-lsp
  :straight t)
(push 'company-lsp company-backends)
(setq company-lsp-enable-snippet t)
#+end_src

*** Minibuffer

**** Vertico

***** Vertico

#+begin_src emacs-lisp :tangle ./init.el
(use-package vertico
  :straight t
  :custom
  (vertico-cycle t)
  :init
  (vertico-mode))
#+end_src

***** Savehist

#+begin_src emacs-lisp :tangle ./init.el
(use-package savehist
    :straight t
  :init
  (savehist-mode))
#+end_src

***** COMMENT Vertico-Posframe

#+begin_src emacs-lisp :tangle no
(use-package vertico-posframe
    :straight t
  :init
  (vertico-posframe-mode))
#+end_src

**** Marginalia

#+begin_src emacs-lisp :tangle ./init.el
(use-package marginalia
  :after vertico
  :straight t
  :custom
  (marginalia-annotators '(marginalia-annotators-heavy marginalia-annotators-light nil))
  :init
  (marginalia-mode))
#+end_src

**** Orderless

#+begin_src emacs-lisp :tangle ./init.el
(use-package orderless
  :straight t
  :custom
  (completion-styles '(orderless basic))
  (completion-category-overrides '((file (styles basic partial-completion)))))
#+end_src

*** Vterm

#+begin_src emacs-lisp :tangle ./init.el
(use-package vterm
  :straight t)
#+end_src

*** OpenWith

#+begin_src emacs-lisp :tangle ./init.el
(use-package openwith
  :straight (:host github :repo "thisirs/openwith")
  :config
  (setq openwith-associations '(("\\.pdf\\'" "setsid -w xdg-open" (file))
                                ;; ("\\.html\\'" "firefox" (file))
                                ("\\.mp4\\'" "setsid -w xdg-open" (file))
                                ("\\.mkv\\'" "setsid -w xdg-open" (file))
                                ))
  (openwith-mode t))
#+end_src

*** COMMENT Emacs-Everywhere
#+begin_src emacs-lisp :tangle no
(use-package emacs-everywhere
  :straight t)
#+end_src

*** Elpher
#+begin_src emacs-lisp :tangle ./init.el
(use-package elpher
  :straight t)
#+end_src

** Keybinds

*** Shift-number

#+begin_src emacs-lisp :tangle ./init.el
(use-package shift-number
  :straight t)

(global-set-key (kbd "C-+") 'shift-number-up)
(global-set-key (kbd "C--") 'shift-number-down)
#+end_src

*** Which-Key

#+begin_src emacs-lisp :tangle ./init.el
(use-package which-key
  :straight t
  :init (which-key-mode)
  :diminish which-key-mode
  :config
  (setq which-key-idle-delay 1.5))
#+end_src

*** Move-Text

#+begin_src emacs-lisp :tangle ./init.el
(use-package move-text
  :straight t)
(global-set-key (kbd "M-S-<up>") 'move-text-up)
(global-set-key (kbd "M-S-<down>") 'move-text-down)
#+end_src

*** Embark

#+begin_src emacs-lisp :tangle ./init.el
   (use-package embark
     :straight t

     :bind
     (("C-." . embark-act)         ;; pick some comfortable binding
      ("M-." . embark-dwim)        ;; good alternative: M-.
      ("C-h B" . embark-bindings)) ;; alternative for `describe-bindings'

     :init

     ;; Optionally replace the key help with a completing-read interface
     (setq prefix-help-command #'embark-prefix-help-command)

     :config

     ;; ;; Hide the mode line of the Embark live/completions buffers
     ;; (add-to-list 'display-buffer-alist
     ;;              '("\\`\\*Embark Collect \\(Live\\|Completions\\)\\*"
     ;;                nil
     ;;                (window-parameters (mode-line-format . none))))
     )
#+end_src

**** Citar-Embark

#+begin_src emacs-lisp :tangle ./init.el
(use-package citar-embark
  :straight t
  :after citar embark
  :no-require
  :config (citar-embark-mode))
#+end_src

** Programming

*** Languages

**** C/C++

#+begin_src emacs-lisp :tangle ./init.el
(add-hook 'c-mode-hook 'lsp)
(add-hook 'c++-mode-hook 'lsp)

(setq lsp-clients-clangd-arg "--header-insertion=never")
#+end_src

**** MIPS Assembly

#+begin_src emacs-lisp :tangle no
(use-package mips-mode
 :straight t
 :mode "\\.s$")
#+end_src

**** Yaml

#+begin_src emacs-lisp :tangle ./init.el
(use-package yaml-mode
    :straight t)
#+end_src

**** Fish Shell

#+begin_src emacs-lisp :tangle ./init.el
(use-package fish-mode
    :straight t)
#+end_src

**** Octave

#+begin_src emacs-lisp :tangle ./init.el
(setq auto-mode-alist
      (cons '("\\.m$" . octave-mode) auto-mode-alist))

(setq-default inferior-octave-startup-args '("-i" "-q" "--line-editing"))
#+end_src

**** Prolog

#+begin_src emacs-lisp :tangle no
(setq auto-mode-alist
      (cons '("\\.pl$" . prolog-mode) auto-mode-alist))
#+end_src

***** ECLiPSe

#+begin_src emacs-lisp :tangle ./init.el
;; (setq prolog-system 'eclipse)

(autoload 'eclipse-mode "/home/kchou/.config/emacs/straight/build/eclipse/eclipse.el" "ECLIPSE editing mode" t)

(setq auto-mode-alist (cons '("\\.pl" . eclipse-mode) auto-mode-alist))
(setq auto-mode-alist (cons '("\\.ecl" . eclipse-mode) auto-mode-alist))
#+end_src

**** Haskell

***** haskell-mode
#+begin_src emacs-lisp :tangle ./init.el
(use-package haskell-mode
  :straight t)

(setq auto-mode-alist
      (cons '("\\.hs$" . haskell-mode) auto-mode-alist))
#+end_src

***** lsp-haskell
#+begin_src emacs-lisp :tangle ./init.el
(use-package lsp-haskell
  :straight t)

(add-hook 'haskell-mode-hook 'lsp)
#+end_src

**** Python

#+begin_src emacs-lisp :tangle ./init.el
(add-hook 'python-mode #'lsp)
#+end_src

***** Pyvenv

#+begin_src emacs-lisp :tangle ./init.el
(use-package pyvenv
  :straight t
  :init
  (setenv "WORKON_HOME" (expand-file-name "~/.conda/envs"))
  :config
  (pyvenv-mode 1)
  )

;; (add-hook 'python-mode-hook #'pyvenv-mode)
;; (add-hook 'python-mode-hook (lambda () (pyvenv-workon 'ai)))
(add-hook 'pyvenv-post-activate-hooks
          #'(lambda ()
              (call-interactively #'lsp)))
#+end_src

***** LSP

#+begin_src emacs-lisp :tangle ./init.el
;; Disables its default "lsp linter", allowing pylint to work

(add-hook 'python-mode-hook
      (lambda ()
        (make-local-variable 'lsp-diagnostic-provider)
        (setq lsp-diagnostic-provider :none)))
#+end_src

**** Sagemath

***** Sage-shell-mode
#+begin_src emacs-lisp :tangle ./init.el
(use-package sage-shell-mode
  :straight t)
#+end_src

*** General

#+begin_src emacs-lisp :tangle ./init.el
  (add-hook 'prog-mode-hook (lambda () (display-line-numbers-mode 1)))
  (add-hook 'prog-mode-hook (lambda () (hl-line-mode 1)))
  (add-hook 'prog-mode-hook (lambda () (display-fill-column-indicator-mode 1)))
  (add-hook 'prog-mode-hook (lambda () (setq truncate-lines t)))

  (setq gc-cons-threshold 100000000)
  (setq read-process-output-max (* 1024 1024)) ;; 1mb
#+end_src

*** LSP

**** Lsp-Mode

#+begin_src emacs-lisp :tangle ./init.el
(use-package lsp-mode
  :straight t
  :commands (lsp lsp-deferred)
  :config
  (define-key lsp-mode-map (kbd "C-c l") lsp-command-map)
  (lsp-enable-which-key-integration t))

;; (setq lsp-diagnostics-provider :flycheck)
#+end_src

**** Lsp-Ui

#+begin_src emacs-lisp :tangle ./init.el
(use-package lsp-ui
  :straight t)
(setq lsp-ui-sideline-enable t)
(setq lsp-ui-doc-enable t)
(setq lsp-ui-doc-position 'at-point)
(setq lsp-ui-doc-show-with-cursor t)
(setq lsp-ui-doc-show-with-mouse t)
#+end_src

**** Lsp-Treemacs

#+begin_src emacs-lisp :tangle ./init.el
(use-package lsp-treemacs
    :straight t)

(lsp-treemacs-sync-mode 1)
#+end_src

*** Flycheck

#+begin_src emacs-lisp :tangle ./init.el
(use-package flycheck
  :straight t
  :init (global-flycheck-mode))
#+end_src

*** Comment-Tags

#+begin_src emacs-lisp :tangle ./init.el
(use-package comment-tags
  :straight t
  :hook ((prog-mode . comment-tags-mode)))
#+end_src

*** Indent-Guide

#+begin_src emacs-lisp :tangle ./init.el
(use-package indent-guide
    :straight t)
(setq indent-guide-char "│")
(setq indent-guide-recursive t)

(add-hook 'prog-mode-hook #'indent-guide-mode)
#+end_src

*** Treemacs

#+begin_src emacs-lisp :tangle ./init.el
(use-package treemacs
  :straight t
  :init
  :config
  (progn
    (setq treemacs-display-in-side-window          t
          treemacs-expand-after-init               t
          treemacs-find-workspace-method           'find-for-file-or-pick-first
          treemacs-indentation                     2
          treemacs-show-cursor                     nil
          treemacs-show-hidden-files               nil
          treemacs-silent-filewatch                nil
          treemacs-silent-refresh                  nil
          treemacs-sorting                         'alphabetic-asc
          treemacs-select-when-already-in-treemacs 'move-back
          treemacs-space-between-root-nodes        t
          treemacs-tag-follow-cleanup              t
          treemacs-text-scale                      nil
          treemacs-user-mode-line-format           nil
          treemacs-user-header-line-format         nil
          treemacs-wide-toggle-width               70
          treemacs-width                           30
          treemacs-width-increment                 1
          treemacs-width-is-initially-locked       t
          treemacs-workspace-switch-cleanup        nil)

    (treemacs-follow-mode nil)
    (treemacs-filewatch-mode nil)
    (treemacs-fringe-indicator-mode 'always)

    (treemacs-hide-gitignored-files-mode nil))
  :bind
  (:map global-map
        ("M-0"       . treemacs-select-window)
        ("C-x t t"   . treemacs)))
#+end_src

**** Treemacs-Icons-Dired

#+begin_src emacs-lisp :tangle ./init.el
(use-package treemacs-icons-dired
  :hook (dired-mode . treemacs-icons-dired-enable-once)
  :straight t)
#+end_src

**** Treemacs-All-the-Icons

#+begin_src emacs-lisp :tangle ./init.el
(use-package treemacs-all-the-icons
  :straight t
  :config
  (treemacs-load-theme "all-the-icons"))
#+end_src

** LaTeX

*** Settings

#+begin_src emacs-lisp :tangle ./init.el
(straight-use-package 'auctex)
(setq-default TeX-master nil)

(setq TeX-auto-save t)
(setq TeX-parse-self t)
(setq TeX-command-extra-options "-shell-escape -interaction=nonstopmode")
(setq-default TeX-engine 'luatex)
(setq-default TeX-PDF-mode t)
(setq TeX-source-correlate-mode t)
(setq TeX-view-program-list '(("Evince" "evince --page-index=%(outpage) %o")))
(setq TeX-view-program-selection '((output-pdf "Evince")))
(setq font-latex-fontify-script nil)
(add-hook 'LaTeX-mode-hook (lambda () (visual-line-mode t)))
(add-hook 'TeX-mode-hook (lambda () (visual-line-mode t)))
#+end_src

*** RefTeX

#+begin_src emacs-lisp :tangle ./init.el
;; Turn on RefTeX in AUCTeX
(add-hook 'LaTeX-mode-hook 'turn-on-reftex)
;; Activate nice interface between RefTeX and AUCTeX
(setq reftex-plug-into-AUCTeX t)
#+end_src

*** Texlab/LSP-LaTeX

#+begin_src emacs-lisp :tangle ./init.el
(use-package lsp-latex
    :straight t)

(with-eval-after-load "tex-mode"
 (add-hook 'TeX-mode-hook 'lsp)
 ;; (add-hook 'latex-mode-hook 'lsp)
 )
#+end_src

*** CDLaTeX
#+begin_src emacs-lisp :tangle ./init.el
(use-package cdlatex
  :straight t)

(add-hook 'LaTeX-mode-hook (lambda () (cdlatex-mode t)))
(add-hook 'TeX-mode-hook (lambda () (cdlatex-mode t)))
#+end_src

** Writing

*** Flyspell

#+begin_src emacs-lisp :tangle ./init.el
  (with-eval-after-load "ispell"
    (setq ispell-program-name "hunspell")
    (setq ispell-dictionary "el_GR,en_US")
    (ispell-set-spellchecker-params)
    (ispell-hunspell-add-multi-dic "el_GR,en_US")
    (setq ispell-personal-dictionary "~/.hunspell_personal"))

(add-hook 'org-mode-hook (lambda () (flyspell-mode 1)))
;; (add-hook 'prog-mode-hook (lambda () (flyspell-prog-mode 1)))
#+end_src

*** Olivetti

#+begin_src emacs-lisp :tangle ./init.el
(setq-default olivetti-body-width 110)
(setq-default olivetti-margin-width 0)
(use-package olivetti
  :straight t
  :hook
  (org-mode . olivetti-mode)
  (markdown-mode . olivetti-mode)
  (Info-mode . olivetti-mode)
  (elpher-mode . olivetti-mode)
  (eww-mode . olivetti-mode)
  (TeX-mode . olivetti-mode)
  (tex-mode . olivetti-mode)
  (LaTeX-mode . olivetti-mode)
  (latex-mode . olivetti-mode))
#+end_src

*** Citar

#+begin_src emacs-lisp :tangle ./init.el
        (use-package citar
          :straight t
          :bind (("C-c b" . citar-insert-citation)
                 ;; :map minibuffer-local-map
                 ;; ("M-b" . citar-insert-preset)
                 )
          :custom
          (citar-bibliography '("~/Textfiles/biblio.bib"))
          :config
            (defvar citar-indicator-files-icons
    (citar-indicator-create
     :symbol (all-the-icons-faicon
              "file-o"
              :face 'all-the-icons-green
              :v-adjust -0.1)
     :function #'citar-has-files
     :padding "  " ; need this because the default padding is too low for these icons
     :tag "has:files"))

  (defvar citar-indicator-links-icons
    (citar-indicator-create
     :symbol (all-the-icons-octicon
              "link"
              :face 'all-the-icons-orange
              :v-adjust 0.01)
     :function #'citar-has-links
     :padding "  "
     :tag "has:links"))

  (defvar citar-indicator-notes-icons
    (citar-indicator-create
     :symbol (all-the-icons-material
              "speaker_notes"
              :face 'all-the-icons-blue
              :v-adjust -0.3)
     :function #'citar-has-notes
     :padding "  "
     :tag "has:notes"))

  (defvar citar-indicator-cited-icons
    (citar-indicator-create
     :symbol (all-the-icons-faicon
              "circle-o"
              :face 'all-the-icon-green)
     :function #'citar-is-cited
     :padding "  "
     :tag "is:cited"))

    (setq citar-indicators
    (list citar-indicator-files-icons
          citar-indicator-links-icons
          citar-indicator-notes-icons
          citar-indicator-cited-icons)))

        ;; (setq citar-symbols
        ;;       `((file ,(all-the-icons-faicon "file-o" :face 'all-the-icons-green :v-adjust -0.1) . " ")
        ;;         (note ,(all-the-icons-material "speaker_notes" :face 'all-the-icons-blue :v-adjust -0.3) . " ")
        ;;         (link ,(all-the-icons-octicon "link" :face 'all-the-icons-orange :v-adjust 0.01) . " ")))
        ;; (setq citar-symbol-separator "  ")
#+end_src

**** Citar-capf

#+begin_src emacs-lisp :tangle ./init.el
;; (require 'citar-capf)

(add-hook 'completion-at-point-functions
          #'citar-capf
          'append)
#+end_src

**** Citar-Org-Roam

#+begin_src emacs-lisp :tangle ./init.el
(use-package citar-org-roam
  :straight t
  :after citar org-roam
  :no-require
  :config (citar-org-roam-mode))
#+end_src

** Git

*** Magit

#+begin_src emacs-lisp :tangle ./init.el
(use-package magit
    :straight t
  :commands magit-status)
#+end_src

** Dired

#+begin_src emacs-lisp :tangle ./init.el
(put 'dired-find-alternate-file 'disabled nil)
(add-hook 'dired-mode-hook (lambda () (hl-line-mode 1)))
#+end_src

*** Dired-Hide-Dotfiles

#+begin_src emacs-lisp :tangle ./init.el
(use-package dired-hide-dotfiles
  :straight t)

(defun my-dired-mode-hook ()
  "My `dired' mode hook."
  ;; To hide dot-files by default
  (dired-hide-dotfiles-mode))

;; To toggle hiding
(define-key dired-mode-map "." #'dired-hide-dotfiles-mode)
(add-hook 'dired-mode-hook #'my-dired-mode-hook)
#+end_src

*** Dired-copy-paste

#+begin_src emacs-lisp :tangle ./init.el
(use-package dired-copy-paste
  :straight (dired-copy-paste :type git :host github :repo "jsilve24/dired-copy-paste"))

(define-key dired-mode-map "\C-c\C-x" 'dired-copy-paste-do-cut)
(define-key dired-mode-map "\C-c\C-c" 'dired-copy-paste-do-copy)
(define-key dired-mode-map "\C-c\C-v" 'dired-copy-paste-do-paste)
#+end_src

** Org

*** Org-Agenda

#+begin_src emacs-lisp :tangle ./init.el
(setq org-agenda-block-separator "\n"
      org-agenda-start-with-log-mode nil
      org-agenda-use-time-grid t
      org-agenda-include-deadlines t
      org-agenda-current-time-string "⭠ now ─────────────────────────────────────────────────"
      org-agenda-span 'day
      org-extend-today-until 4
      org-directory "~/Textfiles/Org files"
      org-agenda-files
      '("~/Textfiles/Org files/Tasks.org"
        "~/Textfiles/Org files/Courses.org"
        "~/Textfiles/Org files/Habits.org"
        "~/Textfiles/Org files/Inbox.org"
        "~/Textfiles/Org files/Phone inbox.org"
        ))

(global-set-key (kbd "C-c a") 'org-agenda)
#+end_src

*** Org-Export

#+begin_src emacs-lisp :tangle ./init.el
;; (setq org-export-backends '(texinfo md man beamer latex html ascii))

(setq org-publish-timestamp-directory '"~/.config/emacs/org-timestamps")

(custom-set-variables
 '(org-cite-csl-styles-dir "/home/kchou/HDD/Έγγραφα/Zotero/styles"))

(setq org-cite-export-processors
       '((latex . (biblatex))
         (t . (csl "ieee.csl"))
         ))
#+end_src

**** HTML Export

#+begin_src emacs-lisp :tangle no
(setq org-html-validation-link nil)
(setq org-html-head-include-default-style t)
(setq org-html-head-include-scripts t)
(setq org-html-metadata-timestamp-format "%A, %d %b %Y")
#+end_src

**** Org-Reveal
#+begin_src emacs-lisp :tangle ./init.el
(use-package ox-reveal
  :straight t)
#+end_src

**** Org-Latex
#+begin_src emacs-lisp :tangle ./init.el
(setq org-latex-compiler "lualatex --synctex=1 -interaction=batchmode")

(setq org-src-preserve-indentation t)
(setq indent-tabs-mode nil)
(setq org-latex-caption-above '(table))

(add-hook 'org-mode-hook
          '(lambda ()
             (delete '("\\.pdf\\'" . default) org-file-apps)
             (add-to-list 'org-file-apps '("\\.pdf\\'" . "evince %s"))))

;; For syntax highlighting in exported code blocks
;; !!Needs python-pygments installed!!
(setq
 org-latex-listings 'minted
 org-latex-pdf-process
 '("lualatex -shell-escape -interaction=nonstopmode -output-directory %o %f"
   "lualatex -shell-escape -interaction=nonstopmode -output-directory %o %f"))

(setq org-export-with-smart-quotes t)

(setq org-latex-hyperref-template "\\hypersetup{
pdfauthor={%a},
pdftitle={%t},
pdfkeywords={%k},
pdfsubject={%d},
pdfcreator={%c}, 
pdflang={%L},
colorlinks,    
linkcolor=blue,
citecolor=red,
urlcolor=blue}")
#+end_src

***** COMMENT engrave-faces

#+begin_src emacs-lisp :tangle no
(use-package engrave-faces
  :straight t)

(setq
  ;; org-latex-listings 'minted
 org-latex-listings 'engraved
 org-latex-engraved-theme "modus-operandi")
#+end_src

**** org-contrib

#+begin_src emacs-lisp :tangle ./init.el
(use-package org-contrib
  :straight t)

(require 'ox-extra)
(ox-extras-activate '(ignore-headlines))
#+end_src

**** Youtube links

Opens youtube links with mpv, and embeds them in the html exports instead of just having the link to it.

#+begin_src emacs-lisp :tangle ./init.el
(defun spook-org--follow-yt-link (path prefix)
  (let* ((url (format "https:%s" path))
         (display-buffer-alist `((,shell-command-buffer-name-async . (display-buffer-no-window)))))
    (if (and prefix (executable-find "mpv"))
        (browse-url url)
      (async-shell-command (format "mpv \"%s\"" url))
      (message "Launched mpv with \"%s\"" url))))

(defun spook-org--export-yt-link (path desc backend)
  (when (eq backend 'html)
    (let* ((video-id (cadar (url-parse-query-string path)))
           (url (if (string-empty-p video-id) path
                  (format "https://youtube.com/embed/%s" video-id))))
      (format
       "<iframe width=\"1000\" height=\"562.5\" src=\"%s\" title=\"%s\" frameborder=\"0\" allowfullscreen></iframe>"
       url desc))))

(org-link-set-parameters "yt" :follow #'spook-org--follow-yt-link :export #'spook-org--export-yt-link)
#+end_src

**** Ox-Hugo

#+begin_src emacs-lisp :tangle ./init.el
(use-package ox-hugo
  :straight t
  :after ox)

(setq org-hugo-base-dir (expand-file-name "~/Repos/Site"))
(setq org-hugo-default-section-directory "posts")
#+end_src

*** Org

#+begin_src emacs-lisp :tangle ./init.el
(use-package org
  :straight (org :type built-in)
  :commands (org-capture org-agenda)
  :config
  (setq org-hide-emphasis-markers nil
        org-ellipsis "…"
        org-startup-indented t
        org-pretty-entities nil
        org-support-shift-select t
        org-fontify-whole-heading-line t
        org-fontify-done-headline t
        org-startup-with-inline-images t
        org-fontify-quote-and-verse-blocks t
        org-deadline-warning-days 14
        org-log-done 'time
        org-log-into-drawer t
        org-auto-align-tags nil
        org-tags-column 0
        org-return-follows-link t
        ))

(add-hook 'org-mode-hook (lambda () (visual-line-mode t)))

(setq org-link-frame-setup '((vm . vm-visit-folder-other-frame)
                             (vm-imap . vm-visit-imap-folder-other-frame)
                             (gnus . org-gnus-no-new-news)
                             (file . find-file)
                             (wl . wl-other-frame)))

(with-eval-after-load 'org
  (add-to-list 'org-modules 'org-habit t))

(setq org-cite-global-bibliography '("/home/kchou/Textfiles/biblio.bib"))

(setq org-image-actual-width (list 700))

(setq org-display-remote-inline-images 'download)

(setq org-link-file-path-type 'relative)
#+end_src

**** Org Bookmarks

#+begin_src emacs-lisp :tangle ./init.el
(setq org-bookmark-names-plist '(:last-capture nil :last-refile nil :last-capture-marker nil))
#+end_src

*** Org-Capture

#+begin_src emacs-lisp :tangle ./init.el
(setq org-default-notes-file "~/Textfiles/Org files/capture.org")

(global-set-key (kbd "C-c c") #'org-capture)

(setq org-capture-bookmark nil)

(setq org-capture-templates
      '(
        ("i" "inbox" entry (file "Inbox.org")
         "* TODO %?")
        ;; ;; todo's for my regular agenda files
        ;; ("t" "Todo" entry (file+headline "~/Textfiles/Org files/Tasks.org" "Capture")
        ;;  "* TODO %?")
        ;; ;; tasks related to uni
        ;; ("u" "Uni" entry (file "~/Textfiles/Org files/Courses.org")
        ;;  "* TODO %?")
        ;; ;; thought capture for org-roam
        ;; ("s" "slipbox" entry (file "~/Textfiles/Braindump/slipbox.org")
        ;;  "* %?")
        ("c" "org-protocol-capture" entry (file "Inbox.org")
         "* TODO [[%:link][%:description]]\n\n %i" :immediate-finish t)
      ))
#+end_src

*** Org-refile

#+begin_src emacs-lisp :tangle ./init.el
(setq org-refile-targets `((nil :maxlevel . 3)
                           (,(directory-files-recursively "~/Textfiles/Org files/" "^[A-Za-zΑ-Ωα-ω0-9]*.org$") :maxlevel . 1)))
                           
(setq org-outline-path-complete-in-steps nil)
(setq org-refile-use-outline-path 'file)
#+end_src

*** Org-store-link

#+begin_src emacs-lisp :tangle ./init.el
(global-set-key (kbd "C-c l") #'org-store-link)
#+end_src

*** Org-Timer

#+begin_src emacs-lisp :tangle ./init.el
(setq org-clock-sound "~/.config/emacs/clock.wav")
#+end_src

*** Oxr

#+begin_src emacs-lisp :tangle ./init.el
(use-package oxr
  :straight (oxr :type git :host github :repo "bdarcus/oxr")
  :bind
  (("C-c r" . oxr-insert-ref)))
#+end_src

*** org-cite-csl-activate

#+begin_src emacs-lisp :tangle ./init.el
(use-package org-cite-csl-activate
  :straight (org-cite-csl-activate :type git :host github :repo "andras-simonyi/org-cite-csl-activate")
  :after citar)

(add-hook 'org-mode-hook (lambda () (cursor-sensor-mode 1)))

(require 'oc-csl-activate)
(setq org-cite-activate-processor 'csl-activate)
;; (setq org-cite-csl-activate-use-citar-cache t)
#+end_src

*** Org-Download

#+begin_src emacs-lisp :tangle ./init.el
(use-package org-download
  :straight t)

(global-set-key (kbd "s-y") #'org-download-clipboard)
#+end_src

*** Org-Babel

#+begin_src emacs-lisp :tangle ./init.el
(org-babel-do-load-languages
 'org-babel-load-languages
 '((emacs-lisp :tangle ./init.el . t)
   (C . t)
   (python . t)
   (octave . t)
   (R . t)
   ))
;; Show syntax highlighting per language native mode in *.org
(setq org-src-fontify-natively t)
;; For languages with significant whitespace like Python:
(setq org-src-preserve-indentation t)

(setq org-confirm-babel-evaluate nil)
#+end_src

**** Ob-Sagemath

#+begin_src emacs-lisp :tangle ./init.el
(use-package ob-sagemath
  :straight t)

;; Ob-sagemath supports only evaluating with a session.
(setq org-babel-default-header-args:sage '((:session . t)
                                           ;; (:results . "drawer")
                                           ))

;; ;; C-c c for asynchronous evaluating (only for SageMath code blocks).
;; (with-eval-after-load "org"
;;   (define-key org-mode-map (kbd "C-c c") 'ob-sagemath-execute-async))

;; ;; Do not confirm before evaluation
;; (setq org-confirm-babel-evaluate nil)

;; ;; Do not evaluate code blocks when exporting.
;; (setq org-export-babel-evaluate nil)

;; ;; Show images after evaluating code blocks.
;; (add-hook 'org-babel-after-execute-hook 'org-display-inline-images)
#+end_src

*** Org-Transclusion

#+begin_src emacs-lisp :tangle ./init.el
(use-package org-transclusion
  :straight t
  :config
  (add-to-list 'org-transclusion-extensions 'org-transclusion-indent-mode))

(define-key global-map (kbd "C-c t a") #'org-transclusion-add)
(define-key global-map (kbd "C-c t t") #'org-transclusion-mode)
#+end_src

*** Org-Plot

#+begin_src emacs-lisp :tangle ./init.el
(use-package gnuplot-mode
  :straight t)

(use-package gnuplot
  :straight t)
#+end_src

*** Org-Pomodoro

#+begin_src emacs-lisp :tangle ./init.el
(use-package org-pomodoro
  :straight t)
(setq org-pomodoro-length 30)
(setq org-pomodoro-short-break-length 6)
(setq org-pomodoro-long-break-length 20)
(setq org-pomodoro-manual-break t)
(setq org-pomodoro-start-sound "~/.config/emacs/clock.wav")
(setq org-pomodoro-finished-sound "~/.config/emacs/clock.wav")
(setq org-pomodoro-short-break-sound "~/.config/emacs/clock.wav")
(setq org-pomodoro-long-break-sound "~/.config/emacs/clock.wav")
#+end_src

*** Org-Pandoc-Import

#+begin_src emacs-lisp :tangle ./init.el
(use-package org-pandoc-import
  :straight (:host github
             :repo "tecosaur/org-pandoc-import"
             :files ("*.el" "filters" "preprocessors")))
#+end_src

*** Zotero links

#+begin_src emacs-lisp :tangle ./init.el
(defun org-zotero-open (path)
  (browse-url-xdg-open (format "zotero:%s" path)))

(with-eval-after-load 'org
  (org-link-set-parameters "zotero" :follow #'org-zotero-open))
#+end_src

*** Org-Crypt

#+begin_src emacs-lisp :tangle ./init.el
(require 'org-crypt)

(with-eval-after-load "org-crypt"
  ;; Automatically encrypts everything that has the tag "crypt"
  ;; when you save the file
  (org-crypt-use-before-save-magic)
  (setq org-tags-exclude-from-inheritance '("crypt"))

  (setq org-crypt-key nil)
  ;; GPG key to use for encryption.
  ;; nil means  use symmetric encryption unconditionally.
  ;; "" means use symmetric encryption unless heading sets CRYPTKEY property.

  (setq auto-save-default nil)
  ;; Auto-saving does not cooperate with org-crypt.el: so you need to
  ;; turn it off if you plan to use org-crypt.el quite often.  Otherwise,
  ;; you'll get an (annoying) message each time you start Org.

  ;; To turn it off only locally, you can insert this:
  ;;
  ;; # -*- buffer-auto-save-file-name: nil; -*-
  )
#+end_src

*** COMMENT Org-Excalidraw

#+begin_src emacs-lisp :tangle no
(use-package org-excalidraw
  :straight (:type git :host github :repo "wdavew/org-excalidraw"))
(setq org-excalidraw-directory "~/Textfiles/Excalidraw/")
#+end_src

*** Org-Analyzer

#+begin_src emacs-lisp :tangle ./init.el
(use-package org-analyzer
  :straight (:host github :repo "rksm/clj-org-analyzer"))
#+end_src

*** Org-Yt

#+begin_src emacs-lisp :tangle ./init.el
(use-package org-yt
  :straight (:host github :repo "league/org-yt"))
#+end_src

** Org-Roam

*** Org-Roam

#+begin_src emacs-lisp :tangle ./init.el
(use-package org-roam
  :straight t

  :init
  (setq org-roam-v2-ack t)

  :custom
  (org-roam-directory "~/Textfiles/Braindump")
  (org-roam-dailies-directory "journals/")
  (org-roam-completion-everywhere t)

  (org-roam-dailies-capture-templates
   '(("d" "default" entry "* %<%H:%M>\n\n %?"
      :empty-lines 1
      :if-new (file+head "%<%Y-%m-%d>.org" "#+title: %<%Y-%m-%d>\n#+filetags: :journal:\n\n"))))

  (org-roam-capture-ref-templates
   '(("r" "ref" plain "%?"
      ;; :if-new (file+head "references/${slug}.org" "#+title: ${title}\n#+date: %U\n\n")
      :if-new (file+head "references/${slug}.org" "#+title: ${title}\n\n")
      :unnarrowed t)))

  (org-roam-capture-templates
   '(
     ("m" "main" plain "%?"
      ;; :if-new (file+head "pages/${slug}.org" "#+title: ${title}\n#+date: %U\n\n")
      :if-new (file+head "pages/${slug}.org" "#+title: ${title}\n\n")
      :unnarrowed t)
     ("p" "post" plain "%?"
      ;; :if-new (file+head "articles/${title}.org" "#+title: ${title}\n#+date: %U\n#+hugo_base_dir: ~/Repos/Site\n#+hugo_section: ./posts\n#+hugo_auto_set_lastmod: t\n#+hugo_draft: true\n\n")
      :if-new (file+head "articles/${title}.org" "#+title: ${title}\n#+hugo_base_dir: ~/Repos/Site\n#+hugo_section: ./posts\n#+hugo_auto_set_lastmod: t\n#+hugo_draft: true\n\n")
      ;; :immediate-finish t
      :unnarrowed t)
     ))

  :bind (("C-c n b" . org-roam-buffer-toggle)
         ("C-c n f" . org-roam-node-find)
         ("C-c n g" . org-roam-graph)
         ("C-c n i" . org-roam-node-insert)
         ("C-c n I" . org-roam-node-insert-immediate)
         ("C-c n c" . org-roam-capture)
         ("C-c n t" . org-roam-tag-add)
         ("C-c n a" . org-roam-alias-add)
         ("C-c n r" . org-roam-ref-add)
         :map org-mode-map
         ("C-M-i"    . completion-at-point))

  :bind-keymap
  ("C-c n d" . org-roam-dailies-map)

  :config
  ;; Creating the property “type” on my nodes
  (cl-defmethod org-roam-node-type ((node org-roam-node))
    "Return the TYPE of NODE."
    (condition-case nil
        (file-name-nondirectory
         (directory-file-name
          (file-name-directory
           (file-relative-name (org-roam-node-file node) org-roam-directory))))
      (error "")))

  ;; If you're using a vertical completion framework, you might want a more informative completion interface
  (setq org-roam-node-display-template (concat "${type:15} ${title:*} " (propertize "${tags:25}" 'face 'org-tag)))

  (org-roam-db-autosync-mode)
  (org-roam-update-org-id-locations)
  (org-roam-setup)
  (require 'org-roam-dailies)
  (require 'org-roam-protocol)
  (require 'org-roam-export)
  )
#+end_src

**** Shows only the surrounding text instead of the whole file in the 'org-roam-buffer' backlinks

#+begin_src emacs-lisp :tangle no
(defun my/preview-fetcher ()
  (let* ((elem (org-element-context))
         (parent (org-element-property :parent elem)))
    ;; TODO: alt handling for non-paragraph elements
    (string-trim-right (buffer-substring-no-properties
                        (org-element-property :begin parent)
                        (org-element-property :end parent)))))

(setq org-roam-preview-function #'my/preview-fetcher)
#+end_src

**** Get 'org-roam-preview-visit' and friends to replace the main window. This should be applicable only when  'org-roam-mode' buffer is displayed in a side-window.

#+begin_src emacs-lisp :tangle ./init.el
(add-hook 'org-roam-mode-hook
          (lambda ()
            (setq-local display-buffer--same-window-action
                        '(display-buffer-use-some-window
                          (main)))))
#+end_src

**** Splits the frame vertically and gives specific amount of space to the 'org-roam-buffer'

#+begin_src emacs-lisp :tangle ./init.el
(add-to-list 'display-buffer-alist
             '("\\*org-roam\\*"
               (display-buffer-in-side-window)
               ;; (dedicated . t)
               (side . right)
               (slot . 0)
               (window-width . 0.33)
               (preserve-size . (t nil))
               (window-parameters . ((no-other-window . t)
                                     (no-delete-other-windows . t)))))
#+end_src

**** Maximizes org-capture buffer

#+begin_src emacs-lisp :tangle ./init.el
(add-hook 'org-capture-mode-hook 'delete-other-windows)
#+end_src

**** Automatically open the *org-roam* buffer when visiting an org-roam file

#+begin_src emacs-lisp :tangle no
(defun tim/org-roam-buffer-show (_)
  (if (and
       ;; Don't do anything if we're in the minibuffer or in the calendar
       (not (minibufferp))
       (not (derived-mode-p 'calendar-mode))
       ;; Show org-roam buffer iff the current buffer has a org-roam file
       (xor (org-roam-file-p) (eq 'visible (org-roam-buffer--visibility))))
      (org-roam-buffer-toggle)))
(add-hook 'window-buffer-change-functions 'tim/org-roam-buffer-show)
#+end_src

**** Bindings

***** node-insert-immediate

#+begin_src emacs-lisp :tangle ./init.el
;; Bind this to C-c n I
(defun org-roam-node-insert-immediate (arg &rest args)
  (interactive "P")
  (let ((args (cons arg args))
        (org-roam-capture-templates (list (append (car org-roam-capture-templates)
                                                  '(:immediate-finish t)))))
    (apply #'org-roam-node-insert args)))
#+end_src

*** Org-Roam-Ui

#+begin_src emacs-lisp :tangle ./init.el
(use-package org-roam-ui
    :straight t)
#+end_src

*** Org-Roam-Timestamps

#+begin_src emacs-lisp :tangle ./init.el
(use-package org-roam-timestamps
    :straight t
    :config
    (org-roam-timestamps-mode))

(setq org-roam-timestamps-remember-timestamps nil)
#+end_src

*** Deft

#+begin_src emacs-lisp :tangle ./init.el
(use-package deft
  :after org
  :straight t
  :bind
  ("C-c n s" . deft)
  :custom
  (deft-recursive t)
  (deft-use-filter-string-for-filename t)
  (deft-default-extension "org")
  (deft-directory "/home/kchou/Textfiles/Braindump")
  :config
  (defun cf/deft-parse-title (file contents)
    "Parse the given FILE and CONTENTS and determine the title.
      If `deft-use-filename-as-title' is nil, the title is taken to
      be the first non-empty line of the FILE.  Else the base name of the FILE is
      used as title."
    (let ((begin (string-match "^#\\+[tT][iI][tT][lL][eE]: .*$" contents)))
      (if begin
          (string-trim (substring contents begin (match-end 0)) "#\\+[tT][iI][tT][lL][eE]: *" "[\n\t ]+")
        (deft-base-filename file))))
  (advice-add 'deft-parse-title :override #'cf/deft-parse-title)
  (setq deft-strip-summary-regexp
        (concat "\\("
                "[\n\t]" ;; blank
                "\\|^#\\+[[:alpha:]_]+:.*$" ;; org-mode metadata
                "\\|^:PROPERTIES:\n\\(.+\n\\)+:END:\n" ;; org-roam ID
                "\\|\\[\\[\\(.*\\]\\)" ;; any link
                "\\)")))
#+end_src

** Ricing

*** Org

**** Org-Modern

#+begin_src emacs-lisp :tangle ./init.el
  (use-package org-modern
    :straight t
    :config
    (setq org-modern-table nil)
    (setq org-modern-block-fringe nil)
    ;; (setq org-modern-star '(""))
    :custom
    (org-modern-hide-stars nil) ; adds extra indentation
    :hook
    (org-mode . org-modern-mode)
    (org-agenda-finalize . org-modern-agenda))
#+end_src

**** Org-Modern-Indent

#+begin_src emacs-lisp :tangle ./init.el
  (use-package org-modern-indent
    :straight (:host github :repo "jdtsmith/org-modern-indent")
    :hook
    (org-mode . org-modern-indent-mode)
    )
#+end_src

**** Org-Pretty-Table-Mode

#+begin_src emacs-lisp :tangle ./init.el
(use-package org-pretty-table
  :straight (:host github :repo "Fuco1/org-pretty-table")
  :hook (org-mode . org-pretty-table-mode))
#+end_src

*** Dashboard

#+begin_src emacs-lisp :tangle ./init.el
(use-package dashboard
  :straight t
  :config
  ;; Set the banner
  (setq dashboard-startup-banner "/home/kchou/Repos/Emacs/logos/gnu-emacs.svg")
  ;; Value can be
  ;; 'official which displays the official emacs logo
  ;; 'logo which displays an alternative emacs logo
  ;; 1, 2 or 3 which displays one of the text banners
  ;; "path/to/your/image.png" or "path/to/your/text.txt" which displays whatever image/text you would prefer
  ;; Content is not centered by default. To center, set
  (setq dashboard-set-navigator t)
  (setq dashboard-center-content t)
  (setq dashboard-banner-logo-title nil)
  (setq dashboard-show-shortcuts nil)
  (setq dashboard-set-heading-icons t)
  (setq dashboard-set-file-icons t)
  (setq dashboard-set-init-info nil)
  (setq dashboard-set-footer nil)
  (setq dashboard-week-agenda nil)
  (setq dashboard-page-separator "\n\n")
  (setq dashboard-items '(;;(bookmarks . 20)
                          ;; (recents . 5)
                          ;; (agenda . 10)
                          ))

  (dashboard-setup-startup-hook))

(setq initial-buffer-choice (lambda () (get-buffer-create "*dashboard*")))
#+end_src

*** Rainbow-Mode

#+begin_src emacs-lisp :tangle ./init.el
(use-package rainbow-mode
  :straight t)
#+end_src

*** Rainbow-Delimeters

#+begin_src emacs-lisp :tangle ./init.el
(use-package rainbow-delimiters
  :straight t
  :hook (prog-mode . rainbow-delimiters-mode))
#+end_src

*** Modeline

**** COMMENT Minions

#+begin_src emacs-lisp :tangle no
(use-package minions
  :straight t
  :config (minions-mode 1))

(setq minions-mode-line-lighter ";")
#+end_src

**** COMMENT Moody
#+begin_src emacs-lisp :tangle no
(use-package moody
 :straight t
  :config
  (setq x-underline-at-descent-line t)
  (moody-replace-mode-line-buffer-identification)
  (moody-replace-vc-mode)
  (moody-replace-eldoc-minibuffer-message-function))

(setq moody-mode-line-height 40)
#+end_src

*** Beacon-Mode

#+begin_src emacs-lisp :tangle ./init.el
(use-package beacon
    :straight t)

(beacon-mode)
#+end_src

*** Xenops

#+begin_src emacs-lisp :tangle ./init.el
(use-package xenops
  :straight t
  :config
  (setq xenops-math-image-scale-factor 1.2)
  )

(add-to-list 'org-latex-packages-alist
	     '("cache=false" "minted" t))

(setq xenops-math-latex-process-alist
      '(
       (dvisvgm :programs
                ("lualatex" "dvisvgm")
                :description "xdv > svg"
                :message "you need to install the programs: lualatex and dvisvgm."
                :image-input-type "dvi"
                :image-output-type "svg"
                :image-size-adjust (1.5 . 1.5)
                :latex-compiler
                ("lualatex --output-format=dvi -interaction=nonstopmode -shell-escape -output-directory %o %f")
                :image-converter
                ("dvisvgm %f -n -b min -c %S -o %O"))
        (dvipng :programs
               ("lualatex" "dvipng")
               :description "dvi > png"
               :message "you need to install the programs: latex and dvipng."
               :image-input-type "dvi"
               :image-output-type "png"
               :image-size-adjust
               (1.0 . 1.0)
               :latex-compiler
               ("lualatex -interaction nonstopmode -shell-escape -output-format dvi -output-directory %o %f")
               :image-converter
               ("dvipng -D %D -T tight -o %O %f"))
       (imagemagick :programs
                    ("latex" "convert")
                    :description "pdf > png"
                    :message "you need to install the programs: latex and imagemagick."
                    :image-input-type "pdf"
                    :image-output-type "png"
                    :image-size-adjust
                    (1.0 . 1.0)
                    :latex-compiler
                    ("pdflatex -interaction nonstopmode -shell-escape -output-directory %o %f")
                    :image-converter
                    ("convert -density %D -trim -antialias %f -quality 100 %O"))))

(setq xenops-math-latex-process 'dvisvgm)
(add-hook 'latex-mode-hook #'xenops-mode)
(add-hook 'LaTeX-mode-hook #'xenops-mode)
(add-hook 'TeX-mode-hook #'xenops-mode)
(add-hook 'org-mode-hook #'xenops-mode)
#+end_src

** Elfeed

*** Elfeed-Org

#+begin_src emacs-lisp :tangle ./init.el
(use-package elfeed-org
  :straight t)

(elfeed-org)
(setq rmh-elfeed-org-files (list "~/.config/emacs/feeds.org"))
#+end_src

*** Elfeed

#+begin_src emacs-lisp :tangle ./init.el
(use-package elfeed
  :straight t)

(setq-default elfeed-search-filter '"+unread")
(setq-default elfeed-db-directory '"~/.config/elfeed")

(global-set-key (kbd "C-x w") 'elfeed)

(defun browse-url-mpv (url &optional new-window)
  (start-process "mpv" "*mpv*" "mpv" url))

(setq browse-url-handlers '(("https:\\/\\/www\\.youtube." . browse-url-mpv) ("." . browse-url-firefox)))
#+end_src

**** eww integration

#+begin_src emacs-lisp :tangle ./init.el
(defun elfeed-eww-open (&optional use-generic-p)
  "open with eww"
  (interactive "P")
  (let ((entries (elfeed-search-selected)))
    (cl-loop for entry in entries
             do (elfeed-untag entry 'unread)
             when (elfeed-entry-link entry)
             do (eww-browse-url it))
    (mapc #'elfeed-search-update-entry entries)
    (unless (use-region-p) (forward-line))))

(define-key elfeed-search-mode-map (kbd "w") 'elfeed-eww-open)
#+end_src

** Anki

*** Anki-Editor

#+begin_src emacs-lisp :tangle ./init.el
(setq-default anki-editor-use-math-jax t)

(use-package anki-editor
  :straight t
  :bind (:map org-mode-map
              ("<f12>" . anki-editor-cloze-region-auto-incr)
              ("<f11>" . anki-editor-cloze-region-dont-incr)
              ("<f10>" . anki-editor-reset-cloze-number)
              ("<f9>"  . anki-editor-push-tree))
  :hook (org-capture-after-finalize . anki-editor-reset-cloze-number) ; Reset cloze-number after each capture.
  :config
  (setq anki-editor-create-decks nil ;; Allow anki-editor to create a new deck if it doesn't exist
        anki-editor-org-tags-as-anki-tags t
        )

  (defun anki-editor-cloze-region-auto-incr (&optional arg)
    "Cloze region without hint and increase card number."
    (interactive)
    (anki-editor-cloze-region my-anki-editor-cloze-number "")
    (setq my-anki-editor-cloze-number (1+ my-anki-editor-cloze-number))
    (forward-sexp))
  
  (defun anki-editor-cloze-region-dont-incr (&optional arg)
    "Cloze region without hint using the previous card number."
    (interactive)
    (anki-editor-cloze-region (1- my-anki-editor-cloze-number) "")
    (forward-sexp))
  
  (defun anki-editor-reset-cloze-number (&optional arg)
    "Reset cloze number to ARG or 1"
    (interactive)
    (setq my-anki-editor-cloze-number (or arg 1)))
  
  (defun anki-editor-push-tree ()
    "Push all notes under a tree."
    (interactive)
    (anki-editor-push-notes '(4))
    (anki-editor-reset-cloze-number))

  ;; Initialize
  (anki-editor-reset-cloze-number)
)
#+end_src

*** Org-Anki

#+begin_src emacs-lisp :tangle no
(use-package org-anki
  :straight t)
#+end_src

* Buffer Shenanigans

#+begin_src emacs-lisp :tangle ./init.el
;; (setq-default message-log-max nil)
;; (kill-buffer "*Messages*")

(defun remove-scratch-buffer ()
  (if (get-buffer "*scratch*")
      (kill-buffer "*scratch*")))
;; (add-hook 'after-change-major-mode-hook 'remove-scratch-buffer)

(kill-buffer "*straight-process*")
(kill-buffer "*elfeed-log*")
#+end_src

* Local Variables

#+begin_src emacs-lisp :tangle ./init.el
(setq enable-local-eval t)
#+end_src
;; Local Variables:
;; eval: (add-hook 'after-save-hook (lambda ()(if (y-or-n-p "Tangle?")(org-babel-tangle))) nil t)
;; End:
